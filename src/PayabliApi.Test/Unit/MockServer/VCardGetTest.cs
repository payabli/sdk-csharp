using NUnit.Framework;
using PayabliApi;
using PayabliApi.Core;

namespace PayabliApi.Test.Unit.MockServer;

[TestFixture]
public class VCardGetTest : BaseMockServerTest
{
    [NUnit.Framework.Test]
    public async Task MockServerTest()
    {
        const string mockResponse = """
            {
              "vcardSent": false,
              "cardToken": "20231206142225226104",
              "cardNumber": "553232XXXXXX3179",
              "cvc": "XXX",
              "expirationDate": "2025-05-01",
              "status": null,
              "amount": 120,
              "currentBalance": 120,
              "expenseLimit": 20,
              "expenseLimitPeriod": null,
              "maxNumberOfUses": 1,
              "currentNumberOfUses": 0,
              "exactAmount": true,
              "mcc": null,
              "tcc": null,
              "misc1": null,
              "misc2": null,
              "dateCreated": "2023-12-06T20:25:31.077Z",
              "dateModified": "2023-12-06T00:00:00.000Z",
              "associatedVendor": {
                "VendorNumber": "VENDOR123456",
                "Name1": "Smith Industries",
                "Name2": "John Smith",
                "EIN": "12-3456789",
                "Phone": "555-123-4567",
                "Email": "contact@smithindustries.com",
                "RemitEmail": null,
                "Address1": "1234 Main Street",
                "Address2": "Suite 200",
                "City": "New York",
                "State": "NY",
                "Zip": "10001",
                "Country": "USA",
                "Mcc": "5411",
                "LocationCode": null,
                "Contacts": [
                  {
                    "ContactName": "Herman Martinez",
                    "ContactEmail": "herman@hermanscoatings.com",
                    "ContactTitle": "Owner",
                    "ContactPhone": "3055550000"
                  }
                ],
                "BillingData": {
                  "id": 123,
                  "accountId": null,
                  "nickname": "Checking Account",
                  "bankName": "Chase Bank",
                  "routingAccount": "021000021",
                  "accountNumber": "3XXXXXX8888",
                  "typeAccount": "Checking",
                  "bankAccountHolderName": "Gruzya Adventure Outfitters LLC",
                  "bankAccountHolderType": "Business",
                  "bankAccountFunction": 0,
                  "verified": true,
                  "status": 1,
                  "services": [],
                  "default": true
                },
                "PaymentMethod": "vcard",
                "VendorStatus": 1,
                "VendorId": 339,
                "EnrollmentStatus": null,
                "Summary": {
                  "ActiveBills": 1,
                  "ActiveBillsAmount": 1.1,
                  "ApprovedBills": 1,
                  "ApprovedBillsAmount": 1.1,
                  "DisapprovedBills": 1,
                  "DisapprovedBillsAmount": 1.1,
                  "InTransitBills": 0,
                  "InTransitBillsAmount": 0,
                  "OverdueBills": 1,
                  "OverdueBillsAmount": 100,
                  "PaidBills": 0,
                  "PaidBillsAmount": 0,
                  "PendingBills": 1,
                  "PendingBillsAmount": 100,
                  "TotalBills": 1,
                  "TotalBillsAmount": 100
                },
                "PaypointLegalname": "Athlete Factory LLC",
                "PaypointDbaname": "Athlete Factory LLC",
                "PaypointEntryname": "PaypointEntryname",
                "ParentOrgName": "HOA Manager Pro",
                "ParentOrgId": 1232,
                "CreatedDate": "2022-07-01T15:00:01.000Z",
                "LastUpdated": "2022-07-01T15:00:01.000Z",
                "remitAddress1": "123 Walnut Street",
                "remitAddress2": "Suite 900",
                "remitCity": "Miami",
                "remitState": "FL",
                "remitZip": "31113",
                "remitCountry": "US",
                "payeeName1": null,
                "payeeName2": null,
                "customField1": "customField1",
                "customField2": "customField2",
                "customerVendorAccount": null,
                "InternalReferenceId": 27,
                "additionalData": null,
                "externalPaypointID": null,
                "StoredMethods": null
              },
              "associatedCustomer": null,
              "ParentOrgName": "HOA Manager Pro",
              "PaypointDbaname": "Athlete Factory LLC",
              "PaypointLegalname": "Athlete Factory LLC",
              "PaypointEntryname": "47acde49",
              "externalPaypointID": null,
              "paypointId": 12345
            }
            """;

        Server
            .Given(
                WireMock
                    .RequestBuilders.Request.Create()
                    .WithPath("/MoneyOut/vcard/20230403315245421165")
                    .UsingGet()
            )
            .RespondWith(
                WireMock
                    .ResponseBuilders.Response.Create()
                    .WithStatusCode(200)
                    .WithBody(mockResponse)
            );

        var response = await Client.MoneyOut.VCardGetAsync("20230403315245421165");
        Assert.That(
            response,
            Is.EqualTo(JsonUtils.Deserialize<VCardGetResponse>(mockResponse)).UsingDefaults()
        );
    }
}
