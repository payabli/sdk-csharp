using NUnit.Framework;
using PayabliApi;
using PayabliApi.Core;

namespace PayabliApi.Test.Unit.MockServer;

[TestFixture]
public class GetApplicationTest : BaseMockServerTest
{
    [NUnit.Framework.Test]
    public async Task MockServerTest()
    {
        const string mockResponse = """
            {
              "annualRevenue": 1000,
              "averageMonthlyVolume": 1000,
              "averageTicketAmount": 1000,
              "bAddress1": "123 Walnut Street",
              "bAddress2": "Suite 103",
              "bankData": [
                {
                  "accountNumber": "123123123",
                  "bankAccountFunction": 1,
                  "bankAccountHolderName": "Gruzya Adventure Outfitters LLC",
                  "bankAccountHolderType": "Business",
                  "bankName": "Test Bank",
                  "id": 123,
                  "nickname": "Withdrawal Account",
                  "routingAccount": "123123123",
                  "typeAccount": "Checking",
                  "accountId": "123-456"
                }
              ],
              "bCity": "New Vegas",
              "bCountry": "US",
              "bFax": "5551234567",
              "binPerson": 60,
              "binPhone": 20,
              "binWeb": 20,
              "boardingLinkId": 91,
              "boardingStatus": 123,
              "boardingSubStatus": 123,
              "bPhone": "5551234567",
              "bStartdate": "01/01/1990",
              "bState": "FL",
              "bSummary": "Brick and mortar store that sells office supplies",
              "builderData": {
                "services": {
                  "ach": {
                    "acceptance": {
                      "ccd": {
                        "ro": false,
                        "value": "<string>"
                      },
                      "ppd": {
                        "ro": false,
                        "value": "<string>"
                      },
                      "web": {
                        "ro": false,
                        "value": "<string>"
                      }
                    },
                    "fees": {
                      "body": [
                        {
                          "columns": [
                            {
                              "value": "<string>"
                            }
                          ]
                        }
                      ],
                      "header": {
                        "columns": [
                          {
                            "value": "<string>"
                          }
                        ]
                      }
                    },
                    "price": {
                      "body": [
                        {
                          "columns": [
                            {
                              "value": "<string>"
                            }
                          ]
                        }
                      ],
                      "header": {
                        "columns": [
                          {
                            "value": "<string>"
                          }
                        ]
                      }
                    }
                  },
                  "card": {
                    "acceptance": {
                      "amex": {
                        "ro": false,
                        "value": "<string>"
                      },
                      "discover": {
                        "ro": false,
                        "value": "<string>"
                      },
                      "mastercard": {
                        "ro": false,
                        "value": "<string>"
                      },
                      "visa": {
                        "ro": false,
                        "value": "<string>"
                      }
                    },
                    "fees": {
                      "body": [
                        {
                          "columns": [
                            {
                              "value": "<string>"
                            }
                          ]
                        }
                      ],
                      "header": {
                        "columns": [
                          {
                            "value": "<string>"
                          }
                        ]
                      }
                    },
                    "price": {
                      "body": [
                        {
                          "columns": [
                            {
                              "value": "<string>"
                            }
                          ]
                        }
                      ],
                      "header": {
                        "columns": [
                          {
                            "value": "<string>"
                          }
                        ]
                      }
                    }
                  }
                },
                "attributes": {
                  "minimumDocuments": 1,
                  "multipleContacts": true,
                  "multipleOwners": true
                },
                "banking": {
                  "depositAccount": {
                    "accountNumber": {
                      "ro": false,
                      "value": "<string>"
                    },
                    "bankName": {
                      "ro": false,
                      "value": "<string>"
                    },
                    "routingAccount": {
                      "ro": false,
                      "value": "<string>"
                    },
                    "typeAccount": {
                      "ro": false,
                      "value": "<string>"
                    }
                  },
                  "withdrawalAccount": {
                    "accountNumber": {
                      "ro": false,
                      "value": "<string>"
                    },
                    "bankName": {
                      "ro": false,
                      "value": "<string>"
                    },
                    "routingAccount": {
                      "ro": false,
                      "value": "<string>"
                    },
                    "typeAccount": {
                      "ro": false,
                      "value": "<string>"
                    }
                  }
                },
                "business": {
                  "address": {
                    "baddress": {
                      "ro": false,
                      "validator": "alphanumeric",
                      "value": "<string>"
                    },
                    "baddress1": {
                      "ro": false,
                      "validator": "alphanumeric",
                      "value": "<string>"
                    },
                    "bcity": {
                      "ro": false,
                      "validator": "alphanumeric",
                      "value": "<string>"
                    },
                    "bcountry": {
                      "ro": false,
                      "value": "<string>"
                    },
                    "bstate": {
                      "ro": false,
                      "value": "<string>"
                    },
                    "bzip": {
                      "ro": false,
                      "validator": "zipcode",
                      "value": "<string>"
                    },
                    "maddress": {
                      "ro": false,
                      "validator": "alphanumeric",
                      "value": "<string>"
                    },
                    "maddress1": {
                      "ro": false,
                      "validator": "alphanumeric",
                      "value": "<string>"
                    },
                    "mcity": {
                      "ro": false,
                      "validator": "alphanumeric",
                      "value": "<string>"
                    },
                    "mcountry": {
                      "ro": false,
                      "value": "<string>"
                    },
                    "mstate": {
                      "ro": false,
                      "value": "<string>"
                    },
                    "mzip": {
                      "ro": false,
                      "validator": "zipcode",
                      "value": "<string>"
                    }
                  },
                  "details": {
                    "btype": {
                      "ro": false,
                      "value": "<string>"
                    },
                    "dbaname": {
                      "ro": false,
                      "validator": "alphanumeric",
                      "value": "<string>"
                    },
                    "ein": {
                      "ro": false,
                      "validator": "routing",
                      "value": "<string>"
                    },
                    "faxnumber": {
                      "ro": false,
                      "validator": "phone",
                      "value": "<string>"
                    },
                    "legalname": {
                      "ro": false,
                      "validator": "alphanumeric",
                      "value": "<string>"
                    },
                    "license": {
                      "ro": false,
                      "validator": "alphanumeric",
                      "value": "<string>"
                    },
                    "licstate": {
                      "ro": false,
                      "value": "<string>"
                    },
                    "phonenumber": {
                      "ro": false,
                      "validator": "phone",
                      "value": "<string>"
                    },
                    "startdate": {
                      "ro": false,
                      "value": "2021-12-13T05:00:00.000Z"
                    },
                    "taxfillname": {
                      "ro": false,
                      "validator": "alphanumeric",
                      "value": "<string>"
                    },
                    "website": {
                      "ro": false,
                      "validator": "url",
                      "value": "<string>"
                    }
                  }
                },
                "owners": {
                  "contact_list": {
                    "contactEmail": {
                      "ro": false,
                      "validator": "email",
                      "value": "<string>"
                    },
                    "contactName": {
                      "ro": false,
                      "validator": "alphanumeric",
                      "value": "<string>"
                    },
                    "contactPhone": {
                      "ro": false,
                      "validator": "phone",
                      "value": "<string>"
                    },
                    "contactTitle": {
                      "ro": false,
                      "validator": "alpha",
                      "value": "<string>"
                    }
                  },
                  "own_list": {
                    "oaddress": {
                      "ro": false,
                      "validator": "alphanumeric",
                      "value": "<string>"
                    },
                    "ocity": {
                      "ro": false,
                      "validator": "alphanumeric",
                      "value": "<string>"
                    },
                    "ocountry": {
                      "ro": false,
                      "value": "<string>"
                    },
                    "odriverstate": {
                      "ro": false,
                      "value": "<string>"
                    },
                    "ostate": {
                      "ro": false,
                      "value": "<string>"
                    },
                    "ownerdob": {
                      "ro": false,
                      "value": "2003-06-05T04:00:00.000Z"
                    },
                    "ownerdriver": {
                      "ro": false,
                      "validator": "alphanumeric",
                      "value": "<string>"
                    },
                    "owneremail": {
                      "ro": false,
                      "validator": "email",
                      "value": "<string>"
                    },
                    "ownername": {
                      "ro": false,
                      "validator": "alphanumeric",
                      "value": "<string>"
                    },
                    "ownerpercent": {
                      "ro": false,
                      "validator": "number",
                      "value": "<string>"
                    },
                    "ownerphone1": {
                      "ro": false,
                      "validator": "phone",
                      "value": "<string>"
                    },
                    "ownerphone2": {
                      "ro": false,
                      "validator": "phone",
                      "value": "<string>"
                    },
                    "ownerssn": {
                      "ro": false,
                      "validator": "routing",
                      "value": "<string>"
                    },
                    "ownertitle": {
                      "ro": false,
                      "validator": "alpha",
                      "value": "<string>"
                    },
                    "ozip": {
                      "ro": false,
                      "validator": "zipcode",
                      "value": "<string>"
                    }
                  }
                },
                "processing": {
                  "avgmonthly": {
                    "ro": false,
                    "validator": "numbers",
                    "value": "<string>"
                  },
                  "binperson": {
                    "ro": false,
                    "value": "<string>"
                  },
                  "binphone": {
                    "ro": false,
                    "value": "<string>"
                  },
                  "binweb": {
                    "ro": false,
                    "value": "<string>"
                  },
                  "bsummary": {
                    "ro": false,
                    "validator": "text",
                    "value": "<string>"
                  },
                  "highticketamt": {
                    "ro": false,
                    "validator": "numbers",
                    "value": "<string>"
                  },
                  "mcc": {
                    "ro": false,
                    "value": "<string>"
                  },
                  "ticketamt": {
                    "ro": false,
                    "validator": "numbers",
                    "value": "<string>"
                  },
                  "whenCharged": {
                    "ro": false,
                    "value": "<string>"
                  },
                  "whenDelivered": {
                    "ro": false,
                    "value": "<string>"
                  },
                  "whenProvided": {
                    "ro": false,
                    "value": "<string>"
                  },
                  "whenRefunded": {
                    "ro": false,
                    "value": "<string>"
                  }
                }
              },
              "bZip": "33000",
              "contactData": [
                {
                  "contactEmail": "herman@hermanscoatings.com",
                  "contactName": "Herman Martinez",
                  "contactPhone": "3055550000",
                  "contactTitle": "Owner",
                  "additionalData": null
                }
              ],
              "createdAt": "2022-07-01T15:00:01.000Z",
              "dbaName": "Sunshine Gutters",
              "documentsRef": {
                "filelist": [
                  {
                    "originalName": "<string>",
                    "zipName": "<string>"
                  }
                ],
                "zipfile": "zx45.zip"
              },
              "ein": "XXXX6789",
              "externalPaypointId": "Paypoint-100",
              "generalEvents": [
                {
                  "description": "Created",
                  "eventTime": "2022-06-17T16:35:21.000Z"
                },
                {
                  "description": "Updated Status",
                  "eventTime": "2022-06-17T16:35:22.000Z",
                  "refData": "1"
                }
              ],
              "highTicketAmount": 1000,
              "idApplication": 325,
              "lastModified": "2022-07-01T15:00:01.000Z",
              "legalName": "Sunshine Services, LLC",
              "license": "2222222FFG",
              "licenseState": "CA",
              "logo": "https://mysite.com/my-logo.png",
              "mAddress1": "123 Walnut Street",
              "mAddress2": "STE 900",
              "mccid": "<string>",
              "mCity": "TN",
              "mCountry": "US",
              "messages": [
                {
                  "content": "Requested business license and bank statements.",
                  "createdAt": "2023-10-30T19:37:20.000Z",
                  "currentApplicationStatus": 3,
                  "currentApplicationSubStatus": 2,
                  "id": 261,
                  "messageType": 1,
                  "originalApplicationStatus": -99,
                  "originalApplicationSubStatus": 0,
                  "roomId": 6,
                  "userId": 104,
                  "userName": "admin"
                },
                {
                  "content": "TIN Failed, Need to reach out to merchant",
                  "createdAt": "2023-10-25T18:41:55.000Z",
                  "currentApplicationStatus": 3,
                  "currentApplicationSubStatus": 3,
                  "id": 231,
                  "messageType": 1,
                  "originalApplicationStatus": -99,
                  "originalApplicationSubStatus": 0,
                  "roomId": 6,
                  "userId": 104,
                  "userName": "admin"
                },
                {
                  "content": "Application approved, finalizing agreement.",
                  "createdAt": "2023-09-09T00:00:00.000Z",
                  "currentApplicationStatus": 7,
                  "currentApplicationSubStatus": 5,
                  "id": 3,
                  "messageType": 1,
                  "originalApplicationStatus": -99,
                  "originalApplicationSubStatus": 0,
                  "roomId": 6,
                  "userId": 5,
                  "userName": "admin"
                }
              ],
              "mState": "TN",
              "mZip": "37615",
              "orgId": 123,
              "orgParentName": "PropertyManager Pro",
              "ownerData": [
                {
                  "oaddress": "33 North St",
                  "ocity": "Any City",
                  "ocountry": "US",
                  "odriverstate": "CA",
                  "ostate": "CA",
                  "ownerdob": "01/01/1990",
                  "ownerdriver": "CA6677778",
                  "owneremail": "test@email.com",
                  "ownername": "John Smith",
                  "ownerpercent": 25,
                  "ownerphone1": "555888111",
                  "ownerphone2": "555888111",
                  "ownerssn": "123456789",
                  "ownertitle": "CEO",
                  "ozip": "55555",
                  "additionalData": null
                }
              ],
              "ownType": "Limited Liability Company",
              "pageidentifier": "<string>",
              "recipientEmailNotification": true,
              "resumable": true,
              "salesCode": "<string>",
              "serviceData": {
                "ach": {
                  "acceptCCD": true,
                  "acceptPPD": true,
                  "acceptWeb": true
                },
                "card": {
                  "acceptAmex": true,
                  "acceptDiscover": true,
                  "acceptMastercard": true,
                  "acceptVisa": true
                },
                "odp": {
                  "allowAch": true,
                  "allowChecks": true,
                  "allowVCard": true,
                  "processing_region": "US",
                  "processor": "tysys",
                  "issuerNetworkSettingsId": "12345678901234"
                }
              },
              "signer": {
                "address": "33 North St",
                "address1": "STE 900",
                "city": "Bristol",
                "country": "US",
                "dob": "01/01/1976",
                "email": "test@email.com",
                "name": "John Smith",
                "phone": "555888111",
                "ssn": "123456789",
                "state": "TN",
                "zip": "55555",
                "pciAttestation": true,
                "signedDocumentReference": "https://example.com/signed-document.pdf",
                "attestationDate": "04/20/2025",
                "signDate": "04/20/2025",
                "additionalData": "{\"deviceId\":\"499585-389fj484-3jcj8hj3\",\"session\":\"fifji4-fiu443-fn4843\",\"timeWithCompany\":\"6 Years\"}"
              },
              "taxfillname": "Sunshine LLC",
              "templateId": 22,
              "websiteAddress": "www.example.com",
              "whencharged": "When Service Provided",
              "whendelivered": "Over 30 Days",
              "whenProvided": "30 Days or Less",
              "whenrefund": "Exchange Only"
            }
            """;

        Server
            .Given(
                WireMock.RequestBuilders.Request.Create().WithPath("/Boarding/read/352").UsingGet()
            )
            .RespondWith(
                WireMock
                    .ResponseBuilders.Response.Create()
                    .WithStatusCode(200)
                    .WithBody(mockResponse)
            );

        var response = await Client.Boarding.GetApplicationAsync(352);
        Assert.That(
            response,
            Is.EqualTo(JsonUtils.Deserialize<ApplicationDetailsRecord>(mockResponse))
                .UsingDefaults()
        );
    }
}
